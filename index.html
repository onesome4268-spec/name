<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚´ IP Â· ìœ„ì¹˜ Â· ì§€ë„ í™•ì¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet ì§€ë„ -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .box {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #map {
      height: 300px;
      border-radius: 10px;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button:active {
      background: #0056b3;
    }
  </style>
</head>
<body>

<h1>ğŸ“ ë‚´ IP Â· ìœ„ì¹˜ Â· ì§€ë„</h1>

<div class="box">
  <p><strong>ë‚´ IP ì£¼ì†Œ</strong></p>
  <p id="ip">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
</div>

<div class="box">
  <p><strong>ë‚´ ìœ„ì¹˜ ì •ë³´</strong></p>
  <p id="status">ìœ„ì¹˜ í™•ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
</div>

<button onclick="getLocation()">ìœ„ì¹˜ í™•ì¸ í—ˆìš©</button>

<div class="box">
  <div id="map"></div>
</div>

<script>
let map;
let marker;

// 1ï¸âƒ£ IP ê¸°ë°˜ ìœ„ì¹˜ (í•­ìƒ ì„±ê³µ)
fetch("https://ipapi.co/json/")
  .then(res => res.json())
  .then(data => {
    document.getElementById("ip").innerText = data.ip;
    document.getElementById("status").innerText =
      `IP ê¸°ë°˜ ìœ„ì¹˜\n${data.city}, ${data.region}`;
    showMap(data.latitude, data.longitude);
  })
  .catch(() => {
    document.getElementById("ip").innerText = "IP ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
  });

// 2ï¸âƒ£ GPS ìœ„ì¹˜ (í—ˆìš© ì‹œ ë” ì •í™•)
function getLocation() {
  const statusEl = document.getElementById("status");

  if (!navigator.geolocation) {
    statusEl.innerText = "ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    return;
  }

  statusEl.innerText = "GPS ìœ„ì¹˜ í™•ì¸ ì¤‘...";

  navigator.geolocation.getCurrentPosition(
    (position) => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      const acc = position.coords.accuracy;

      statusEl.innerText =
        `GPS ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ\nì •í™•ë„: ì•½ ${Math.round(acc)}m`;

      showMap(lat, lon);
    },
    () => {
      statusEl.innerText =
        "GPS ìœ„ì¹˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ IP ê¸°ë°˜ ìœ„ì¹˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.";
    },
    {
      enableHighAccuracy: false,
      timeout: 20000,
      maximumAge: 60000
    }
  );
}

// ì§€ë„ í‘œì‹œ
function showMap(lat, lon) {
  if (!map) {
    map = L.map("map").setView([lat, lon], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "Â© OpenStreetMap"
    }).addTo(map);

    marker = L.marker([lat, lon]).addTo(map);
  } else {
    map.setView([lat, lon], 13);
    marker.setLatLng([lat, lon]);
  }
}
</script>

</body>
</html>
