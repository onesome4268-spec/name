<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚´ IP Â· ìœ„ì¹˜ Â· ì§€ë„ í™•ì¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet ì§€ë„ -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .box {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #map {
      height: 300px;
      border-radius: 10px;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button:active {
      background: #0056b3;
    }
  </style>
</head>
<body>

<h1>ğŸ“ ë‚´ IP Â· ìœ„ì¹˜ Â· ì§€ë„</h1>

<div class="box">
  <p><strong>ë‚´ IP ì£¼ì†Œ</strong></p>
  <p id="ip">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
</div>

<div class="box">
  <p><strong>ë‚´ ìœ„ì¹˜ ì •ë³´</strong></p>
  <p id="status">ë²„íŠ¼ì„ ëˆŒëŸ¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
</div>

<button onclick="getLocation()">ìœ„ì¹˜ í™•ì¸ í—ˆìš©</button>

<div class="box">
  <div id="map"></div>
</div>

<script>
let map;
let marker;

// IP ê°€ì ¸ì˜¤ê¸°
fetch("https://api.ipify.org?format=json")
  .then(res => res.json())
  .then(data => {
    document.getElementById("ip").innerText = data.ip;
  })
  .catch(() => {
    document.getElementById("ip").innerText = "IP ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
  });

function getLocation() {
  const statusEl = document.getElementById("status");

  if (!navigator.geolocation) {
    statusEl.innerText = "ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    return;
  }

  statusEl.innerText = "ìœ„ì¹˜ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

  navigator.geolocation.getCurrentPosition(
    (position) => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      statusEl.innerText =
        `ìœ„ì¹˜ í™•ì¸ ì™„ë£Œ\nìœ„ë„: ${lat}\nê²½ë„: ${lon}`;

      showMap(lat, lon);
    },
    (error) => {
      switch (error.code) {
        case error.PERMISSION_DENIED:
          statusEl.innerText = "ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.";
          break;
        case error.POSITION_UNAVAILABLE:
          statusEl.innerText = "ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          break;
        case error.TIMEOUT:
          statusEl.innerText = "ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.";
          break;
        default:
          statusEl.innerText = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}

function showMap(lat, lon) {
  if (!map) {
    map = L.map("map").setView([lat, lon], 16);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "Â© OpenStreetMap"
    }).addTo(map);

    marker = L.marker([lat, lon]).addTo(map);
  } else {
    map.setView([lat, lon], 16);
    marker.setLatLng([lat, lon]);
  }
}
</script>

</body>
</html>
